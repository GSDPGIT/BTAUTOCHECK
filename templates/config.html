{% extends "base.html" %}

{% block title %}é…ç½®ç®¡ç† - BTAUTOCHECK{% endblock %}

{% block content %}
<h2 style="margin-bottom: 2rem;">âš™ï¸ é…ç½®ç®¡ç†</h2>

<form id="configForm" method="POST">
    <div class="card">
        <div class="card-header">åŸºç¡€é…ç½®</div>
        
        <div class="form-group">
            <label>å®‰å…¨è¯„åˆ†é˜ˆå€¼</label>
            <input type="number" name="security_threshold" value="{{ config.security_threshold }}" min="0" max="100">
            <small style="color: #868e96;">ä½äºæ­¤åˆ†æ•°å°†å‘å‡ºè­¦å‘Šï¼ˆæ¨èï¼š80ï¼‰</small>
        </div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 1rem;">
                <span>å¯ç”¨é€šçŸ¥åŠŸèƒ½</span>
                <label class="switch">
                    <input type="checkbox" name="notification_enabled" {% if config.notification_enabled %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </label>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">å¤‡ä»½é…ç½®</div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 1rem;">
                <span>å¯ç”¨å¤‡ä»½åŠŸèƒ½</span>
                <label class="switch">
                    <input type="checkbox" name="backup_enabled" {% if config.backup_enabled %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 1rem;">
                <span>å‡çº§å‰è‡ªåŠ¨å¤‡ä»½</span>
                <label class="switch">
                    <input type="checkbox" name="backup_before_upgrade" {% if config.backup_before_upgrade %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 1rem;">
                <span>å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š</span>
                <label class="switch">
                    <input type="checkbox" name="auto_rollback_on_failure" {% if config.auto_rollback_on_failure %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="form-group">
            <label>ä¿ç•™å¤‡ä»½æ•°é‡</label>
            <input type="number" name="keep_backups" value="{{ config.keep_backups }}" min="1" max="20">
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">Serveré…±é€šçŸ¥</div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 1rem;">
                <span>å¯ç”¨Serveré…±</span>
                <label class="switch">
                    <input type="checkbox" name="serverchan_enabled" {% if config.notifications.serverchan.enabled %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </label>
        </div>
        
        <div class="form-group">
            <label>SendKey</label>
            <input type="text" name="serverchan_sendkey" value="{{ config.notifications.serverchan.sendkey }}" placeholder="SCT...">
            <small style="color: #868e96;">ä» https://sct.ftqq.com/ è·å–</small>
        </div>
    </div>
    
    <div style="display: flex; gap: 1rem;">
        <button type="submit" class="btn btn-primary">ğŸ’¾ ä¿å­˜é…ç½®</button>
        <button type="button" onclick="testNotification()" class="btn btn-success">ğŸ“¨ æµ‹è¯•é€šçŸ¥</button>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('configForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    fetch('{{ url_for("config_management") }}', {
        method: 'POST',
        body: new URLSearchParams(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('âœ… ' + data.message);
            location.reload();
        } else {
            alert('âŒ ' + (data.message || 'ä¿å­˜å¤±è´¥'));
        }
    })
    .catch(error => {
        alert('âŒ ä¿å­˜å¤±è´¥: ' + error);
    });
});

function testNotification() {
    ajaxPost('{{ url_for("test_notification") }}', {}, function(data) {
        if (data.success) {
            alert('âœ… ' + data.message);
        } else {
            alert('âŒ ' + data.message);
        }
    });
}
</script>
{% endblock %}

