{% extends "base.html" %}
{% block title %}å¤‡ä»½ç®¡ç† - BTAUTOCHECK{% endblock %}
{% block content %}
<h2 style="margin-bottom: 2rem;">ğŸ’¾ å¤‡ä»½ç®¡ç†</h2>
<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <span>å¤‡ä»½åˆ—è¡¨</span>
        <button onclick="createBackup()" class="btn btn-primary">+ åˆ›å»ºæ–°å¤‡ä»½</button>
    </div>
    {% if backups %}
    <table>
        <thead>
            <tr><th>ç‰ˆæœ¬</th><th>å¤§å°</th><th>åˆ›å»ºæ—¶é—´</th><th>è¯´æ˜</th><th>æ“ä½œ</th></tr>
        </thead>
        <tbody>
            {% for backup in backups %}
            <tr>
                <td><span class="badge badge-success">{{ backup.version }}</span></td>
                <td>{{ (backup.size / (1024*1024)) | round(2) }} MB</td>
                <td>{{ backup.created_at }}</td>
                <td>{{ backup.description }}</td>
                <td><button onclick="restoreBackup('{{ backup.filepath }}')" class="btn btn-danger" style="padding: 0.5rem 1rem;">æ¢å¤</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #868e96; text-align: center; padding: 2rem;">æš‚æ— å¤‡ä»½</p>
    {% endif %}
</div>
{% endblock %}
{% block extra_js %}
<script>
function createBackup() {
    const version = prompt('è¯·è¾“å…¥ç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ï¼š11.2.0ï¼‰ï¼š', '{{ stats.current_version if stats else "manual" }}');
    if (!version) return;
    const desc = prompt('è¯·è¾“å…¥å¤‡ä»½è¯´æ˜ï¼ˆå¯é€‰ï¼‰ï¼š', 'æ‰‹åŠ¨å¤‡ä»½');
    ajaxPost('{{ url_for("backup_create") }}', {version: version, description: desc}, function(data) {
        alert(data.success ? 'âœ… ' + data.message : 'âŒ ' + data.message);
        if (data.success) location.reload();
    });
}
function restoreBackup(filepath) {
    if (!confirm('âš ï¸ è­¦å‘Šï¼šæ¢å¤å¤‡ä»½ä¼šè¦†ç›–å½“å‰é¢æ¿ï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) return;
    ajaxPost('{{ url_for("backup_restore", filepath=filepath) }}', {}, function(data) {
        alert(data.success ? 'âœ… ' + data.message : 'âŒ ' + data.message);
        if (data.success) setTimeout(() => location.reload(), 2000);
    });
}
</script>
{% endblock %}

