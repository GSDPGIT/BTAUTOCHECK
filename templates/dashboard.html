{% extends "base.html" %}

{% block title %}ä»ªè¡¨æ¿ - BTAUTOCHECK{% endblock %}

{% block content %}
<h2 style="margin-bottom: 2rem;">ğŸ“Š ä»ªè¡¨æ¿</h2>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">å½“å‰ç‰ˆæœ¬</div>
        <div class="stat-value">{{ stats.current_version }}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">å®‰å…¨é˜ˆå€¼</div>
        <div class="stat-value">{{ stats.security_threshold }}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">å¤‡ä»½æ•°é‡</div>
        <div class="stat-value">{{ stats.backup_count }}</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">é€šçŸ¥çŠ¶æ€</div>
        <div class="stat-value">
            {% if stats.notification_enabled %}
            <span style="color: #51cf66;">âœ“</span>
            {% else %}
            <span style="color: #ff6b6b;">âœ—</span>
            {% endif %}
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">å¿«é€Ÿæ“ä½œ</div>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <button onclick="runCheck()" class="btn btn-primary">
            ğŸ” ç«‹å³æ£€æµ‹æ–°ç‰ˆæœ¬
        </button>
        <button onclick="testNotification()" class="btn btn-success">
            ğŸ“¨ æµ‹è¯•é€šçŸ¥
        </button>
        <a href="{{ url_for('config_management') }}" class="btn btn-secondary">
            âš™ï¸ é…ç½®ç®¡ç†
        </a>
        <a href="{{ url_for('backup_list') }}" class="btn btn-secondary">
            ğŸ’¾ å¤‡ä»½ç®¡ç†
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header">æœ€è¿‘çš„å®‰å…¨æŠ¥å‘Š</div>
    {% if reports %}
    <table>
        <thead>
            <tr>
                <th>æ–‡ä»¶å</th>
                <th>å¤§å°</th>
                <th>ç”Ÿæˆæ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td>{{ report.filename }}</td>
                <td>{{ (report.size / 1024) | round(2) }} KB</td>
                <td>{{ report.mtime }}</td>
                <td>
                    <a href="{{ url_for('report_view', filename=report.filename) }}" class="btn btn-primary" style="padding: 0.5rem 1rem;">æŸ¥çœ‹</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #868e96; text-align: center; padding: 2rem;">æš‚æ— æŠ¥å‘Š</p>
    {% endif %}
</div>

<div class="card">
    <div class="card-header">æœ€è¿‘æ—¥å¿—</div>
    <div class="log-viewer">
        <pre>{% for log in logs %}{{ log }}
{% endfor %}</pre>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function runCheck() {
    if (!confirm('ç¡®å®šè¦ç«‹å³å¼€å§‹æ£€æµ‹å—ï¼Ÿ\næ£€æµ‹è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚')) {
        return;
    }
    
    ajaxPost('{{ url_for("run_check") }}', {}, function(data) {
        if (data.success) {
            alert('âœ… ' + data.message);
            setTimeout(function() {
                location.reload();
            }, 2000);
        } else {
            alert('âŒ ' + data.message);
        }
    });
}

function testNotification() {
    if (!confirm('ç¡®å®šè¦å‘é€æµ‹è¯•é€šçŸ¥å—ï¼Ÿ')) {
        return;
    }
    
    ajaxPost('{{ url_for("test_notification") }}', {}, function(data) {
        if (data.success) {
            alert('âœ… ' + data.message);
        } else {
            alert('âŒ ' + data.message);
        }
    });
}
</script>
{% endblock %}

